{% extends "base.html" %}

{% block content %}

<style>
  .health-section {
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 8px;
      background: #f9f9f9;
      text-align: left;
  }
  .health-bar {
      padding: 10px;
      border-radius: 8px;
      color: #ffffff;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
  }
  .health-reasons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
  }
  .health-tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: #eeeeee;
      font-size: 12px;
  }
</style>

<div class="box">
    <h1>Today {{ today }}</h1>

    {% if plant_name %}
        <p>Plant: <strong>{{ plant_name }}</strong></p>
    {% else %}
        <p>Plant: <em>No plant name set yet</em></p>
    {% endif %}


    {# ====== Plant Health Level ====== #}
    {% if health_panel %}
        <div class="section health-section">
            <h2>Plant Health Status</h2>
            <div class="health-bar" style="background-color: {{ health_panel.color }};">
                Health Level: {{ health_panel.health_level }}
            </div>

            {% if health_panel.reasons %}
                <div class="health-reasons">
                    {% for tag in health_panel.reasons %}
                        <span class="health-tag">{{ tag }}</span>
                    {% endfor %}
                </div>
            {% endif %}

            {% if health_panel.timestamp %}
                <p style="margin-top:8px;font-size:12px;color:#666;">
                    Last assessment: {{ health_panel.timestamp.replace("T", " ").split('.')[0] }}
                </p>
            {% endif %}
        </div>
    {% else %}
        <div class="section health-section">
            <h2>Plant Health Status</h2>
            <p>No health assessment record yet.</p>
        </div>
    {% endif %}

    <div class="section">
        <h2>Today's Watering Log</h2>

        {% if today_flag == "watered" %}
            <p>Status: <strong>The system has automatically watered today ✅</strong></p>
            <p>The total amount of water watered today: <strong>{{ today_total_ml }} ml</strong></p>
            {% if last_watering_time %}
                <p>Last watering time:
                    <strong>{{ last_watering_time.replace("T", " ") }}</strong>
                </p>
            {% endif %}
        {% elif today_flag == "no_water" %}
            <p>Status：<strong>The system was not watered today ❌</strong></p>
            <p>The total amount of water watered today: <strong>0 ml</strong></p>
        {% else %}
            <p>Status：
                <strong>There are no decision records today</strong>
                There is neither a watering record nor a reported status of "no watering today".
            </p>
            <p>The total amount of water watered today:<strong>{{ today_total_ml }} ml</strong></p>
        {% endif %}

        {% if today_note %}
            <p><strong>Note: </strong>{{ today_note }}</p>
        {% else %}
            <p><strong>Note: </strong>Wait for the system's decision or report the reason.</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>Recent automatic watering records</h2>
        {% if recent_records %}
            <table class="log-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Watering amount (ml)</th>
                    </tr>
                </thead>
                <tbody>
                {% for r in recent_records %}
                    <tr>
                        <td>
                            {% if r.timestamp %}
                                {{ r.timestamp.replace("T", " ") }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ r.water_ml }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>There is no automatic watering record yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
